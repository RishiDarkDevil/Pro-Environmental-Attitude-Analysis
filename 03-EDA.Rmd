# Results

Here we will take a look at the structure of the data visually and through various tools available to us known as descriptive statistics and will also infer about these results. We will seek for hidden patterns, trends and dependence of variables in our data. We will examine the overall, item-wise per domain and domain-wise data and correlations. Our goal as before would be to extract as much information as possible, about pro-environmental attitude of college students of India from the response data.

## Visualization

```{r EDA_data_prep, warning=FALSE}
# Summary of the data
desc_summ <- describe(data[,3:ncol(data)])

# Summary of the net_score data
desc_score_summ <- describe(data_net_score[,3:ncol(data_net_score)])

# Converting Data from Wide to Long Form
# Factoring the non-reverse score responses
data_long <- data[,3:ncol(data)] %>%
  gather(everything(), key = "Qsn", value = "Resp")
data_long$Resp <- factor(data_long$Resp, levels = levels)

# Making Stacked Bar Plots for Grouped Qsns and Response
Qsn_Name <- c("^SA.", "^REC.", "^PC.", "^SS.", "^ER.", "^ES.", "^RES.", "^CON.")
Plot_Nmaes <- c("Recycling", "Environmental Safety", "Percieved Control", "Social Support", "Environmental Reductionism", "Environmental Sensitivity", "Reuse", "Conservation")

Plot_Nmaes1 <- c("Environmental Safety", "Recycling", "Percieved Control", "Social Support", "Environmental Reductionism", "Environmental Sensitivity", "Reuse", "Conservation")
```

I avoid presenting tables throughout the analysis as I believe the mere numbers presented as they are provide no information by just looking at them until and unless coupled with plots and necessary remarks and have kept them to be presented in the Appendix section, if needed. I tried presenting all the results of the data directly in the plots and have kept away from presenting too much cumbersome information. Every plot is coupled with necessary remarks and insight to be drawn.

-   Let's look at the response proportion for each questions(we refer them as items). We see a **very large proportion of people have filled Agree and Strongly Agree for all the items in every domain**, this hints us towards the fact that our sample shows inclination towards pro-environmental attitude. We will see more on this further in the study though several other plots and analysis.

```{r stacked_bar_plot, fig.asp=1.2, fig.width=14, warning=FALSE}
gen_stacked_barplots <- function(plot_data = data_long, title = "") {
  stacked_bar_plot <<- list()
  loop <- length(Qsn_Name)
  rows <- 4
  loop_cols <- Qsn_Name
  for (i in 1:loop) {
    stacked_bar_plot[[i]] <<- plot_data %>%
      filter(str_detect(Qsn, Qsn_Name[i])) %>%
      ggplot() +
      geom_bar(aes(Qsn, fill = Resp), position = "fill")  +
      labs(
        x = NULL,
        y = NULL
      ) +
      theme_bw() +
      theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
            panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
      ggtitle(Plot_Nmaes1[[i]]) +
      theme(
        panel.border = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(colour = "black"),
        strip.background = element_blank(),
        legend.position = "none"
      ) +
      scale_fill_viridis(discrete = TRUE) +
      coord_flip()
  }
   
  stacked_bar_plot <- ggarrange(
    plotlist = stacked_bar_plot, 
    ncol = 2, nrow = 4,
    common.legend = TRUE, legend = "bottom"
  )
  
  
  annotate_figure(
    stacked_bar_plot,
    left = text_grob("Question Codes", rot = 90),
    bottom = text_grob("Proportion"),
    top = text_grob(title, face = "bold", size = 16)
  )
}

# Generate Stacked bar plots for non-reverse scored questions
gen_stacked_barplots(title = "Response Proportions for Each Item")
```

Before Looking into anything else, we see what the average pro-environmental score of the students is and looking at the 95% confidence interval it seems the overall performance is very good standing at above 80%.

```{r mean_tot_score_ci, fig.asp=0.618, fig.width=14}
# CI for Mean Pro-Environmental Score
bootstrap_dist <- data_net_tot_score %>%
  specify(response = TOT) %>%
  generate(reps = 5000, type = "bootstrap") %>%
  calculate(stat = "mean")

percentile_ci <- bootstrap_dist %>%
  get_confidence_interval(level = 0.95, type = "percentile")

visualise(bootstrap_dist) +
  labs(
    x = "Average Pro-Environmental Attitude Score",
    y = "Count"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  theme(
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "black"),
    strip.background = element_blank(),
    legend.position = "none"
  ) + 
  ggtitle("95% C.I.-Bootstrap Distribution of Mean Pro-Environmental Attitude Score") +
  shade_ci(endpoints = percentile_ci, color = "hotpink", fill = "khaki") +
  geom_text(
    aes(Inf, Inf, label = paste("lower ci:",round(percentile_ci$lower_ci, digits = 2), ", upper ci:",round(percentile_ci$upper_ci, digits = 2))),
    vjust = "top", hjust = "right", size = 5
  )
```

We will now look at the correlation between several variables in our data i.e. the correlation between the items and the correlation between the domains and will draw necessary insight from them. **After going through the questionnaire one can think that the questions all revolve around the same topic of environmental attitude so, we expect that the items and domains should be having strong correlation among themselves**. We will see the validity of this in the analysis below.

-   We take a look at the correlation between all the item's response. We observe that there is a **high positive correlation between all the items from all the domains.** It means that people who Agree on one item are likely to Agree with most of the other items and vice-versa. The negatively correlated items(the darker cells) are very few in number and even if they are negatively correlated the strength is very low maxing out at -0.25(only one or two items) mostly between -0.1 and 0.

```{r corplot_all_items, fig.asp=1, fig.width=14, message=FALSE, warning=FALSE}
# Correlation between All Qsn Scores
suppressMessages(data_enc[,3:ncol(data_enc)] %>%
  ggcorr() +
  scale_fill_viridis() +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank(), panel.border = element_blank(), line = element_blank()) +
  ggtitle("Correlation Plot for All Items"))
```

-   We now look at the pairwise correlation between the domain scores of individuals, we look at the results based on the gender to see how each gender's domain scores correlate. Since, **all the domains are closely related to environmental attitude of an individual it is natural to expect that if a person scores high in any one domain he is likely to have higher pro-environmental attitude overall** (see later for verification of this claim from the sample) **and hence have high scores in the other domains too.** Thus, **we see all the domain scores are highly correlated and the correlation strength are similar for both the genders**. The regression line fit also reveals positive slope, which means **higher score in one domain is likely to imply higher score in other domains and hence overall higher pro-environmental attitude**(check further in the study to see this idea explored more). Some disparity in few lines is solely due to limited sample. Hence, our sample adheres to what we believe. The purple denotes Female and yellow denotes Male.

```{r pair_plot, fig.asp=0.8, fig.width=14}
# Generate Pair Plots for Net Score of Items
my_fn <- function(data, mapping, ...){
  p <- ggplot(data = data, mapping = mapping) + 
    geom_point() + 
    geom_smooth(method=lm, formula = y~x, size = 1, se = FALSE, ...)
  p
}

# Colored on the basis of Sex
data_net_score %>%
           mutate(Sex = as.factor(Sex)) %>%
           ggpairs(columns = c("REC", "SA", "PC", "SS", "ER", "ES", "RES", "CON"), aes(color = Sex), lower = list(continuous = my_fn), progress = FALSE) +
           scale_color_viridis(discrete = TRUE) +
           theme_bw() +
           theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
                 panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
           ggtitle("Scatterplot Matrix for Total Score of Domains")
```

-   Now, after seeing the correlation between the net score of the domains. We take a closer look at each domain's items and how they correlate among themselves. We got a rough idea of it from the first correlation plot of each item. This reveals that there is **all the items in each domain are highly positively correlated with each other**. There is no negative correlation observed between items of the same domain, which is consistent with what is expected.

```{r corr_plot_each_item_each_domain, fig.asp=1.2, fig.width=14}
# Tile Plots for correlation for each Qsn in each Category
Qsn_Name_Cont <- c("REC", "SA", "PC", "SS", "ER", "ES", "RES", "CON")

corrplots <- list()
for (i in seq_along(Qsn_Name_Cont)) {
  suppressMessages(corrplots[[i]] <- data_enc %>%
    select(matches(Qsn_Name[[i]])) %>%
    ggcorr(label = TRUE) +
    scale_fill_viridis() +
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank(), panel.border = element_blank(), line = element_blank()) +
    ggtitle(Plot_Nmaes1[[i]]))
}

corrplots <- ggarrange(
  plotlist = corrplots, 
  ncol = 2, nrow = 4
)

annotate_figure(
  corrplots,
  top = text_grob("Correlation Plots", face = "bold", size = 16)
)
```

With this we have an overall idea of the correlation among items and domains as well as the proportion of subjects in the response data we collected. We will now move to the next section to infer something from the data. We will nonetheless carry on with visualizing the data wherever possible and necessary.

## Inference

Here in this section, we will conduct several hypothesis testings to find out statistically significant results i.e. if there is enough evidence to say that the population we are targeting posses pro-environmental attitude using the limited sample we have.

We will also estimate several statistical measures like mean, give confidence intervals and fit probability density functions.

**In the following analysis, quite obviously higher score implies more inclined towards Pro-Environmental Attitude and lower score implies the opposite i.e. less inclined to Pro-Environmental Attitude**.

-   We have already seen in the previous section how our sample shows inclination pro-environmental attitude i.e. the larger proportion of people agreeing to pro-environmental items. Even though mean and median give good amount of information of the average behavior of the population using the sample, a good fit of probability density functions would reveal the behavior of the entire population and what overall shape of response histogram we can expect. We see that **weibull distribution fit all the scores the best out of our choice of probability density functions**.(Best fit is decided by Kolmogorov-Smirnov Goodness of Fit) Weibull distribution is similar to normal distribution but it accounts for the skewness or bias seen in the data whereas normal distribution is symmetric. **The fact that Weibull fits better than normal is an evidence that the underlying distribution of the population is skewed towards higher score i.e. our population shows tendency towards high pro-environmental attitude**. One important thing to note is that **the observed skewness of all the domain net scores is negative implying that most of the data is skewed towards higher scores and hence higher pro-environmental attitude**. We also observe **high average and median score**. The QQ-Plot shown beside the data histogram agrees with our fit.

```{r fit_pdfs, fig.asp=3.2, fig.width=16, warning=FALSE}
ev_finder <- function(transform = identity) {
  function(f, ..., from = -Inf, to = Inf) {
    integrate(function(x) transform(x) * f(x, ...), from, to)
  }
}

moment_finder <- function(n, c = 0) {
  ev_finder(function(x) (x - c) ^ n)
}

find_mean <- moment_finder(1)
find_variance <- function(f, ...) {
  mu <- find_mean(f, ...)$value
  moment_finder(2, mu)(f, ...)
}

fit_distribution <- function(data, title_name = "Model & Data", qqtitle = NULL){
  fit_g <<- invisible(fitdistrplus::fitdist(data, "gamma"))
  fit_l <<- invisible(fitdistrplus::fitdist(data, "lnorm"))
  fit_w <<- invisible(fitdistrplus::fitdist(data, "weibull"))
  fit_n <<- invisible(fitdistrplus::fitdist(data, "norm"))
  
  plot.legend <- c("gamma", "lognormal", "weibull", "normal")
  gof <<- fitdistrplus::gofstat(list(fit_g, fit_l, fit_w, fit_n), fitnames = plot.legend)
  
  p1 <- fitdistrplus::denscomp(list(fit_g, fit_l, fit_w, fit_n), legendtext = plot.legend, fitlwd = c(2,2,2,2), xlegend = 0.007, plotstyle = "ggplot") #, fit_e), legendtext = plot.legend, fitlwd = c(3,3.5,4,4.5,1), xlegend = 0.007)

  p2 <- fitdistrplus::qqcomp  (list(fit_g, fit_l, fit_w, fit_n), legendtext = plot.legend, plotstyle = "ggplot")
  
  p1 <- p1 +
    theme(legend.justification = c(1, 1), legend.position = c(1, 1)) + ggtitle(title_name) + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
  
  p2 <- p2  +
    theme(legend.position = "None") + ggtitle(qqtitle) + labs(subtitle = paste(rownames(as.data.frame(gof$ks[which.min(gof$ks)])), "seems to fit the data better.")) + theme(axis.title.x = element_blank(), axis.title.y = element_blank())

  p <- ggarrange(p1, p2, ncol = 2)
  return(p)
}

proper_fit_distribution <- function(data, heading = "Model & Data"){
  
  invisible(capture.output(p <- fit_distribution(data, heading)))
  
  tf <<- (map_df(list(list(fit_g, fit_l, fit_w, fit_n)[as.numeric(which.min(gof$ks))][[1]]$estimate), tidy)) %>%
    spread(key = names, value = x) %>% 
    mutate(across(where(is.numeric), ~ round(., digits = 2)))
  
  table <- ggtexttable(tibble(Fit = c(colnames(tf)[1], as.character(tf[1]),colnames(tf)[2], as.character(tf[2])[1])), theme = ttheme("mCyan"), rows = NULL)
  
  if(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$distname == "weibull")
    tablea <-  ggtexttable(tibble(Moments = c("Mean", round(find_mean(dweibull, scale = as.numeric(tf[1]), shape = as.numeric(tf[2]))$value, digits = 2), "Var", round(find_variance(dweibull, scale = as.numeric(tf[1]), shape = as.numeric(tf[2]))$value, digits = 2))), theme = ttheme("mBlue"), rows = NULL)
  if(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$distname == "lnorm")
    tablea <-  ggtexttable(tibble(Moments = c("Mean", round(exp(as.numeric(tf[1]) + 0.5*as.numeric(tf[2])^2), digits = 2), "Var", round(exp(as.numeric(tf[1])*2 + 0.5*4*as.numeric(tf[2])^2) - (exp(as.numeric(tf[1])*1 + 0.5*as.numeric(tf[2])^2))^2, digits = 2))), theme = ttheme("mBlue"), rows = NULL)
  if(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$distname == "gamma")
    tablea <-  ggtexttable(tibble(Moments = c("Mean", round(find_mean(dgamma, rate = as.numeric(tf[1]), shape = as.numeric(tf[2]))$value, digits = 2), "Var", round(find_variance(dgamma, rate = as.numeric(tf[1]), shape = as.numeric(tf[2]))$value, digits = 2))), theme = ttheme("mBlue"), rows = NULL)
  if(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$distname == "norm")
    tablea <-  ggtexttable(tibble(Moments = c("Mean", round(find_mean(dnorm, mean = as.numeric(tf[1]), sd = as.numeric(tf[2]))$value, digits = 2), "Var", round(find_variance(dnorm, mean = as.numeric(tf[1]), sd = as.numeric(tf[2]))$value, digits = 2))), theme = ttheme("mBlue"), rows = NULL)
  if(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$distname == "exp")
    tablea <-  ggtexttable(tibble(Moments = c("Mean", round(1/as.numeric(tf[1]), digits = 2), "Var", round(1/(as.numeric(tf[1]))^2, digits = 2))), theme = ttheme("mGreen"), rows = NULL)
  
  table <- ggarrange(table, tablea, nrow = 1, ncol = 2)
  
  data_sum <- describe(data)
    
  tableab <-  ggtexttable(tibble(Obsvd = c("Mean", round(data_sum$mean, digits = 2), "sd", round(data_sum$sd, digits = 2), "median", round(data_sum$median, digits = 2), "skew", round(data_sum$skew, digits = 2)), Data = c("kurt", round(data_sum$kurtosis, digits = 2), "min", round(data_sum$min, digits = 2), "max", round(data_sum$max, digits = 2), "se", round(data_sum$se, digits = 2))), theme = ttheme("mGreen"), rows = NULL)
  
  table <- ggarrange(table, tableab, nrow = 2, heights = c(5, 7))
  
  p <- ggarrange(p, table, nrow = 1, ncol = 2, widths = c(10,1))
  return(p)
}

fit_pdf <- list()
for (i in seq_along(data_net_score[,3:ncol(data_net_score)])) {
  fit_pdf[[i]] <- annotate_figure(
    proper_fit_distribution(data_net_score[[i+2]]),
    top = text_grob(Plot_Nmaes[i], size = 14)
  )
}

fit_pdf <- ggarrange(
  plotlist = fit_pdf, 
  ncol = 1, nrow = 8
)

annotate_figure(
  fit_pdf,
  top = text_grob("MLE Fit of Probability Density Functions to Total Score of Each Domain", face = "bold", size = 16)
)
```

-   We will now look at the mean response score for each item in each domain and we have also mentioned the confidence interval for these scores. As expected from the above analysis and overall pro-environmental attitude inclined sample. The mean score for each item is more than 3(about 4 or above, which is above 80% of the total score that can be obtained out of a total of 5). The standard error(which gives the confidence interval as the 95% confidence interval is nothing but the interval [mean-1.96\*se, mean+1.96\*se]) is low. So, **looking at the 95% C.I. for the scores we can be sure that our sample definitely gives good estimate that the mean for each item is much above 3 i.e. on an average the population is more inclined towards pro-environmental attitude**.

```{r each_item_each_domain, fig.asp=1.2, fig.width=14}
# Mean and CI of each Qsn for each item

desc_sum <- describe(data_enc[,3:ncol(data_enc)])
desc_sum <- as_tibble(desc_sum) %>%
  mutate(Qsn = rownames(desc_sum))

mean_bar_plot <- list()

for (i in seq_along(Qsn_Name)) {
  mean_bar_plot[[i]] <- desc_sum %>%
    filter(str_detect(Qsn, Qsn_Name[i])) %>%
    ggplot() +
    geom_bar(aes(Qsn, mean, fill = Qsn), stat = "identity")  +
    geom_errorbar(aes(x=Qsn, ymin=mean-1.96*se, ymax=mean+1.96*se), width=0.4, colour="black", alpha=0.5, size=1.5) +
    labs(
      x = NULL,
      y = NULL
    ) +
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
    ggtitle(Plot_Nmaes1[[i]]) +
    geom_text(aes(Qsn, mean, label=paste0("mean= ",round(mean, 2)," ,se= ",round(se, 2))), position=position_dodge(width=0.9), hjust = 1.5, color = "black", size = 5) +
    theme(
      panel.border = element_blank(),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.line = element_line(colour = "black"),
      strip.background = element_blank(),
      legend.position = "none"
    ) +
    scale_fill_viridis(discrete = TRUE) +
    coord_flip()
}
  
mean_bar_plot <- ggarrange(
  plotlist = mean_bar_plot, 
  ncol = 2, nrow = 4
)
  
  
annotate_figure(
  mean_bar_plot,
  left = text_grob("Question Codes", rot = 90),
  bottom = text_grob("Average Response"),
  top = text_grob("Average Response and Confidence Intervals for Each Item", face = "bold", size = 16)
)
```

-   We see similar results as the above one from the net score in each domain. We see that that the average net score in each domain is just 5 less than than the total score that can be obtained in that domain. The small 95% confidence interval makes us believe more that the sample average is very good standing at above 75% of the total score. Hence, in **every domain we see high levels of awareness and hence high pro-environmental attitude.**

```{r each_domain, fig.asp=0.618, fig.width=14}
# Mean and CI Bar Plot for Net Scores
desc_score_sum <- as_tibble(desc_score_summ) %>%
  mutate(Qsn = rownames(desc_score_summ))

Q_Name <- c("REC", "SA", "PC", "SS", "ER", "ES", "RES", "CON")

desc_score_sum %>%
  ggplot() +
  geom_bar(aes(Qsn, mean, fill = Qsn), stat = "identity")  +
  geom_errorbar(aes(x=Qsn, ymin=mean-1.96*se, ymax=mean+1.96*se), width=0.4, colour="black", alpha=0.5, size=1.5) +
  labs(
    x = "Category",
    y = "Average Total Score"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  ggtitle("Average Response and Confidence Intervals for Each Category") +
  geom_text(aes(Qsn, mean, label=paste0("mean= ",round(mean, 2),"% ,se=",round(se, 2), "%")), position=position_dodge(width=0.9), hjust = 1.5, color = "black", size = 5) +
  theme(
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "black"),
    strip.background = element_blank(),
    legend.position = "none"
  ) +
  scale_fill_viridis(discrete = TRUE) +
  coord_flip()
```

-   We will now see whether the males and females have different take on pro-environmental attitude. To do this analysis we frame our null hypothesis that males and females on an average don't differ in pro-environmental attitude. We test this null against a two-sided alternative. We carried a two-sample t-test and found out that we are not able to reject the null hypothesis. Hence, we conclude that **there is not enough statistical evidence that male and female differ on their take in pro-environmental attitude**. So, just as were doing from the start, we won't differentiate between male and female scores. We also test the null hypothesis of the people living in joint family and nuclear family having same pro-environmental attitude against the two-sided alternative. We again find that **there is not enough statistical evidence that people belonging to joint family and nuclear family differ on their take in pro-environmental attitude**. We find that the average pro-environmental score of most of the domains are almost similar i.e. conducting the one-factor ANOVA test for equality of means we find that **there is not enough statistical evidence to reject the fact that the means of all the domain scores are different**. **I strongly believe that these tests are limited by the sample size and if we had access to a bigger sample the means of all the domain scores in a single one-factor ANOVA test would come out to be same**.

```{r boxplots, fig.asp=0.8, fig.width=14}
# Boxplots

# Gender Boxplot of Total Score
present_t.test <- function(t.test, table_theme = "mBlue", footnote = "", digs = 2) {
  table.fit <- tidy(t.test) %>%
    select(-c("method", "alternative")) %>%
    mutate(across(where(is.numeric), ~ round(., digits = digs)))
  
  table1 <- ggtexttable(table.fit, theme = ttheme(table_theme), rows = NULL) %>%
    tab_add_footnote(text = str_c(t.test$method, ", ", t.test$alternative, footnote), size = 10, face = "italic")
  
  return(table1)
}

present_aov.test <- function(aov.test, table_theme = "mBlue", footnote = "", digs = 2) {
  table.fit <- tidy(aov.test) %>%
    mutate(across(where(is.numeric), ~ round(., digits = digs)))
  
  table1 <- ggtexttable(table.fit, theme = ttheme(table_theme), rows = NULL) %>%
    tab_add_footnote(text = footnote, size = 10, face = "italic")
  
  return(table1)
}

boxplot1 <- data_tot_score %>%
  mutate(Sex = as.factor(Sex), Family = as.factor(Family)) %>%
  ggplot() +
  geom_boxplot(aes(Score, fct_reorder(Sex, Score), fill = Sex)) +
  labs(
    x = "Pro-Environmental Score",
    y = "Sex"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  theme(
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "black"),
    strip.background = element_blank(),
    legend.position = "none"
  ) +
  scale_fill_viridis(discrete = TRUE)


gen_v_tot_score_t_test <- t.test(Score ~ Sex, data = data_tot_score, var.equal = TRUE)
gen_v_tot_score_t_test <- present_t.test(gen_v_tot_score_t_test, footnote = " for Sex vs Total Score")

# Family Boxplot of Total Score
boxplot2 <- data_tot_score %>%
  mutate(Sex = as.factor(Sex), Family = as.factor(Family)) %>%
  ggplot() +
  geom_boxplot(aes(Score, fct_reorder(Family, Score), fill = Family)) +
  labs(
    x = "Pro-Environmental Score",
    y = "Family"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  theme(
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "black"),
    strip.background = element_blank(),
    legend.position = "none"
  ) +
  scale_fill_viridis(discrete = TRUE)


fam_v_tot_score_t_test <- t.test(Score ~ Family, data = data_tot_score)
fam_v_tot_score_t_test <- present_t.test(fam_v_tot_score_t_test, footnote = " for Family vs Total Score")


# Category Scores
boxplot3 <- data_net_score[,3:ncol(data_net_score)] %>%
  gather(everything(), key = "Category", value = "Score") %>%
  mutate(Category = as.factor(Category)) %>%
  ggplot() +
  geom_boxplot(aes(Score, fct_reorder(Category, Score), fill = Category)) +
  labs(
    x = "Pro-Environmental Category Score",
    y = "Question Category"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  theme(
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "black"),
    strip.background = element_blank(),
    legend.position = "none"
  ) +
  scale_fill_viridis(discrete = TRUE)

Cat_Score_aov <- aov(Score ~ Category, data = data_net_score[,3:ncol(data_net_score)] %>%
                       gather(everything(), key = "Category", value = "Score") %>%
                       mutate(Category = as.factor(Category)) %>%
                       filter(Category %in% c("SA", "REC", "ES", "CON", "PC")))

Cat_Score_aov <- present_aov.test(Cat_Score_aov, footnote = "One-Factor Anova for SA, REC, ES, CON, PC Scores", digs = 2)

Cat_Score_aov2 <- aov(Score ~ Category, data = data_net_score[,3:ncol(data_net_score)] %>%
                       gather(everything(), key = "Category", value = "Score") %>%
                       mutate(Category = as.factor(Category)) %>%
                       filter(Category %in% c("ER", "REC", "ES", "CON")))

Cat_Score_aov2 <- present_aov.test(Cat_Score_aov2, footnote = "One-Factor Anova for  ER, REC, ES, CON Scores", digs = 2)

Cat_Score_aov3 <- aov(Score ~ Category, data = data_net_score[,3:ncol(data_net_score)] %>%
                       gather(everything(), key = "Category", value = "Score") %>%
                       mutate(Category = as.factor(Category)) %>%
                       filter(Category %in% c("PC", "SS", "RES")))

Cat_Score_aov3 <- present_aov.test(Cat_Score_aov3, footnote = "One-Factor Anova for PC, SS, RES Scores", digs = 2)


tests <- ggarrange(gen_v_tot_score_t_test, fam_v_tot_score_t_test, Cat_Score_aov, Cat_Score_aov2, Cat_Score_aov3, ncol = 1, nrow = 5)

p <- ggarrange(boxplot1, boxplot2, boxplot3, tests, ncol = 2, nrow = 2, heights = c(5, 7))

annotate_figure(
  p,
  top = text_grob("Pro-Environmental Category Scores and Total Scores", face = "bold", size = 16)
)

```

With this we conclude the inference section of our study. We will use the insights gained from this section and the previous section to guide our data analysis further in the next sections.

## Modeling

In this section, we will see the dependence of one domain score on the other domain scores, the item scores on the domain scores and domain scores on the total scores. This will help us identify which domain score is the most differentiating so as to get higher pro-environmental scores. It is important because those are the domains we need to improve so as to achieve better total scores. We won't be fitting complicated black box models as our goal is not to predict the pro-environmental attitude of a student rather we want to draw inferences from the models. Linear Models fit perfectly in that sense.

-   First, we start by looking at the domain score's dependence on the other domain scores. This will help us get an idea of how knowing that one person scores in all the domains except one will perform in the left out domain. From the coefficient forest plot below we see that most of the coefficients in the significant linear model have high positive values except one(which on inspecting the 95% C.I. indicated by the horizontal line across each estimate reveals it to be insignificant with high p-value). Thus, **if a person has high scores in all the domains, it is expected and observed that he will have high scores in the rest of the domain**. We also observe all the other domain scores explains the variability of RES, REC, CON and ER domain score(looking at the model R-squared values, these are above 60%) very well. It also gives us important information that **if we can foster education among students on the domains they are less aware of we can expect them to have improved pro-environmental score on the other domains as well**. Thus, **improving the awareness with special focus on SS, ES, SA and PC is needed because improving awareness on REC, REC, CON and ER won't improve pro-environmental attitude in these domains**(with low model R-square).

```{r domain_on_domain_MLR, fig.asp=0.618, fig.width=16}

present_R.2 <- function(mods, table_theme = "mBlue", footnote = "Model R-squared", visual = TRUE) {
  mods_summ <- mods %>%
    map(~summary(.))
  R.squared <<- tibble("Model" = Qsn_Name_Cont,  
                      "R_square" = round(mods_summ %>%
                                            map_dbl(~.$r.squared), digits = 2), 
                      "Adj_R_square" = round(mods_summ %>%
                                                map_dbl(~.$adj.r.squared), digits = 2))
  if(!visual){
  p <- ggtexttable(R.squared, theme = ttheme(table_theme), rows = NULL) %>%
    tab_add_footnote(text = footnote, size = 10, face = "italic")}
  else{
    p <- R.squared %>%
      gather(R_square, Adj_R_square, key = "Metric", value = "value") %>%
      mutate(Model = as.factor(Model)) %>%
      ggplot(aes(fct_reorder(Model, value), value, color = Metric, group = Metric)) +
      geom_line(size = 1.5) +
      geom_point(size = 2.5) +
      theme_bw() +
      theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
            panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
      ggtitle("Model Performance") +
      theme(
        panel.border = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(colour = "black"),
        strip.background = element_blank()
      ) + 
      labs(
        x = "Model",
        y = "Metric Value"
      ) + 
      scale_color_viridis(discrete = TRUE)
  }
  return(p)
}

present_ssr <- function(mods, table_theme = "mBlue", footnote = "Model R-squared", visual = TRUE) {
  mods_summ <- mods %>%
    map(~summary(.))
  SSR <<- tibble("Model" = Qsn_Name_Cont,  
                       "SSR" = round(mods_summ %>%
                                            map_dbl(~sum(.$residuals^2)/.$df[2]), digits = 2))
  if(!visual){
    p <- ggtexttable(SSR, theme = ttheme(table_theme), rows = NULL) %>%
      tab_add_footnote(text = footnote, size = 10, face = "italic")}
  else{
    p <- SSR %>%
      mutate(Model = as.factor(Model)) %>%
      ggplot(aes(fct_reorder(Model, SSR, .desc = TRUE), SSR, group = 1)) +
      geom_line(size = 1.5) +
      geom_point(size = 2.5) +
      theme_bw() +
      theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
            panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
      ggtitle("Model Residuals") +
      theme(
        panel.border = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.line = element_line(colour = "black"),
        strip.background = element_blank()
      ) + 
      labs(
        x = "Model",
        y = "Sum of Squares Residuals"
      )
  }
  return(p)
}

format_reg_table <- function(model, digs = 2){
  mod <- tidy(model, conf.level = .99, conf.int = TRUE) %>%
    mutate(across(where(is.numeric), ~ round(., digits = digs)))
  mod <- mod %>%
    mutate(estimate = as.character(estimate)) %>%
    mutate(estimate = paste(paste(estimate, ifelse(p.value < 0.05, "*",""), ifelse(p.value < 0.01, "*",""), ifelse(p.value < 0.001, "*",""), sep = ""), paste("[", conf.low, ", ", conf.high, "]", sep = ""), sep = "\n"))
  mod <- mod %>%
    select(term, estimate)
  return(mod)
}

present_reg_mod <- function(model, title = "", table_theme = "mOrange") {
  p <- ggtexttable(format_reg_table(model), theme = ttheme(table_theme), rows = NULL) %>%
    tab_add_title(text = title, face = "bold", padding = unit(0.1, "line")) %>%
    tab_add_footnote(text = paste("*** p < 0.001; ** p < 0.01;", " * p < 0.05; 99% C.I.", sep = "\n"), size = 10, face = "italic")
  return(p)
}

# Linear Model Dependence between the Categories
lin_mod_cats <- Qsn_Name_Cont %>%
  map(~str_c(.,"~.")) %>%
  map(~lm(as.formula(.), data = data_net_score[,3:ncol(data_net_score)]))

sig_lin_mod_cats <- lin_mod_cats %>%
  map(~step(., direction = "both", trace = 0))

sig_lin_mod_cats_summ <- sig_lin_mod_cats %>%
  map(~summary(.))

sig_lin_mod_cats_plot <- plot_summs(
  sig_lin_mod_cats,
  inner_ci_level = .95,
  omit.coefs = "(Intercept)",
  model.names = Qsn_Name_Cont, 
  colors = "Rainbow",
  point.size = 6
)  +
  theme(plot.title = element_text(size = 14, hjust = 0.5), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank(),
        plot.subtitle = element_text(size=12, hjust=0.5, face="italic", color="black")) +
  ggtitle("Linear Model Coefficients") +
  labs(subtitle = "Multiple Linear Regression Coefficients, including only the significant variables(By both forward and backward model selection)")

# model_present_list <- list()
# for (i in seq_along(Qsn_Name_Cont)) {
#   model_present_list[[i]] <- present_reg_mod(sig_lin_mod_cats[[i]], str_c("Model ", Qsn_Name_Cont[i]))
# }

model_info_table <- sig_lin_mod_cats %>%
  map(~format_reg_table(.)) %>%
  reduce(full_join, by = c('term'))
model_info_table <- model_info_table[2:nrow(model_info_table),]
model_info_table[is.na(model_info_table)] <- " "
colnames(model_info_table) <- c("term", Qsn_Name_Cont)

model_info_table <- ggtexttable(model_info_table, theme = ttheme("mOrange"), rows = NULL) %>%
  tab_add_title(text = "Model Fit Estimates", face = "bold", padding = unit(0.1, "line")) %>%
  tab_add_footnote(text = "*** p < 0.001; ** p < 0.01; * p < 0.05; 99% C.I.", size = 10, face = "italic")

R.2.table <- present_R.2(sig_lin_mod_cats, "mRed", "Model Performance")
Resid.table <- present_ssr(sig_lin_mod_cats, "mRed", "Model Performance")
# Models <- ggarrange(model_info_table, R.2.table, nrow = 1, ncol = 2, widths = c(8,4))
Models <- ggarrange(R.2.table, Resid.table, nrow = 2, ncol = 1)
# p <- ggarrange(sig_lin_mod_cats_plot, Models, ncol = 1, nrow = 2, heights = c(8, 4))

p <- ggarrange(sig_lin_mod_cats_plot, Models, ncol = 2, nrow = 1, widths = c(8, 4))

annotate_figure(
  p,
  top = text_grob("Linear Model for Dependence of Each Category Score on All Other", face = "bold", size = 16)
)
```

-   Let's look at the dependence of the item scores on the domain score. We will look at it in two ways to better understand what's going on. We below fit a linear regression model of each item on the domain score, so as to understand given a particular total pro-environmental score in a particular domain, what is the expected scores in each of the items of that domain. We observe **increase in any item score increases the overall score in that domain**(from the correlation graphs among items we know one item score increases implies other scores are likely to be high too). We observe an issue with 3 items i.e. REC2, PC1, SA1 as even when the domain score is 100%(which means all item scores for that individual must be 5) our fitted regression line predicts that item score to be 4 or slightly less than 4 this means that the students even with high pro-environmental attitude find it difficult to agree with these items and on looking at these items we understand that **there is need for education and awareness on these items i.e. imparting education on upcycling old products into new and useful items(REC2), on the cost and issues of safe disposal of waste products(SA1) and managing waste around an individuals surroundings(PC1)**. We also get an idea of which items are generally agreed by most of the people(even the ones with lower pro-environmental score) i.e. if we draw a vertical line in each of the plots we will get the score of each item predicted at that level of domain awareness. All the items in SS and ES have same predicted scores whereas in REC, REC1 is the highest scored; in SA, SA4 is highest scored; in PC, PC4 is highest scored; in ER, ER1 is highest scored; In RES, RES4 is highest scored and in CON, CON3 is highest scored. So, **most of the students at all level of domain awareness(domain pro-environmental score) agrees that recycling is useful, proper precaution for safe disposal of waste/toxic chemical should be taken, environmental conservation is everyone's responsibility, we can save water by closing the taps when we brush and conservation can help in creating a greener planet for future**.

```{r item_on_domain_LR, fig.asp=1.2, fig.width=14}
# Linear Model Dependence for each item to the Category net score

data_enc_1 <- data_enc %>%
  bind_cols(data_net_score[,3:ncol(data_net_score)])

lin_mod_items_on_cats <- list()
Qsn_Name1 <- c("^REC", "^SA", "^PC", "^SS", "^ER", "^ES", "^RES", "^CON")
for (i in seq_along(Qsn_Name1)) {
  lin_mod_items_on_cats[[i]] <- data_enc_1[,3:ncol(data_enc_1)] %>%
    select(matches(Qsn_Name1[i])) %>%
    gather(everything(), key = "Items", value = "Score", -one_of(Qsn_Name_Cont[i])) %>%
    ggplot(aes(.data[[Qsn_Name_Cont[[i]]]], Score, color = Items)) +
    geom_point() +
    geom_smooth(method = "lm", formula = "y~x", se = FALSE, size = 2) +
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
    ggtitle(Plot_Nmaes[i]) +
    theme(
      panel.border = element_blank(),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.line = element_line(colour = "black"),
      strip.background = element_blank()
    ) +
    scale_color_viridis(discrete = TRUE)
} +
  labs(
    x = NULL,
    y = NULL
  )

lin_mod_items_on_cats <- ggarrange(
  plotlist = lin_mod_items_on_cats, 
  ncol = 2, nrow = 4
)

annotate_figure(
  lin_mod_items_on_cats,
  left = text_grob("Item Score", rot = 90),
  bottom = text_grob("Total Score(In %)"),
  top = text_grob("Regression Fit of Item Scores on Domain Score", face = "bold", size = 16)
)
```

-   After we have seen the above insight, it is quite natural to ask how can we improve on the overall domain score by imparting education particular to each item. We will answer that now by looking at the dependence of Total Score in each domain on the item scores that compose it. Obviously, we see as expected that there is positive slope as increasing item score increases domain score trivially. One important thing to notice is that agreeing completely or scoring even full in one item doesn't imply that the overall domain score is near full, it maxes out at about 90% for almost all the domains, which reinforces the fact that **better broad knowledge regarding all sorts of items that comprises a domain is needed to improve the domain level awareness to near 100%**. We see that is the slope of REC2, SA1, PC1, PC2, PC3, PC6, SS1 are lower compared to rest of the items which implies as of now(from our sample's level of environmental education) that improving the take on these items would show very less increase in domain score. Thus, **we need to focus in imparting education regarding upcyling, cost of disposal of waste, maintaining our surroundings to be waste free, believing in individual actions can improve climate**.

```{r domain_on_item_LR, fig.asp=1.2, fig.width=14}
# Linear Model Dependence for each item to the Category net score

data_enc_1 <- data_enc %>%
  bind_cols(data_net_score[,3:ncol(data_net_score)])

lin_mod_items_on_cats <- list()
Qsn_Name1 <- c("^REC", "^SA", "^PC", "^SS", "^ER", "^ES", "^RES", "^CON")
for (i in seq_along(Qsn_Name1)) {
  lin_mod_items_on_cats[[i]] <- data_enc_1[,3:ncol(data_enc_1)] %>%
    select(matches(Qsn_Name1[i])) %>%
    gather(everything(), key = "Items", value = "Score", -one_of(Qsn_Name_Cont[i])) %>%
    ggplot(aes(Score, .data[[Qsn_Name_Cont[[i]]]], color = Items)) +
    geom_point() +
    geom_smooth(method = "lm", formula = "y~x", se = FALSE, size = 2) +
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
    ggtitle(Plot_Nmaes[i]) +
    theme(
      panel.border = element_blank(),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.line = element_line(colour = "black"),
      strip.background = element_blank()
    ) +
    scale_color_viridis(discrete = TRUE)
} +
  labs(
    x = NULL,
    y = NULL
  )

lin_mod_items_on_cats <- ggarrange(
  plotlist = lin_mod_items_on_cats, 
  ncol = 2, nrow = 4
)

annotate_figure(
  lin_mod_items_on_cats,
  left = text_grob("Total Score(In %)", rot = 90),
  bottom = text_grob("Item Score"),
  top = text_grob("Regression Fit of Domain Score on Item Scores", face = "bold", size = 16)
)
```

-   Finally, we take a look on the same analysis we saw above for items conducted on domain level awareness and overall pro-environment score. We breakdown the predicted composition of the total pro-environmental attitude(overall score) in terms of the domain scores. We see that **students have higher contribution in their overall pro-environmental attitude from the domain awareness of environmental reductionism**. Apart from Environment Reductionism all the other domain scores maxes out at around 90% when the total score is 100%(i.e. all the domain scores should be nearer to 100%). Hence, **we need awareness focusing on all the other domains of recycling, environmental safety, perceived control, social support, environmental sensitivity, reuse and conservation**. It is observed that **students scored lesser in social support, environmental safety and perceived control compared to other domains**. The R-squared plots also confirms that the student's overall **pro-environmental attitude is mainly contributed by RES, PC, REC, CON, ER and we need to work more on the domains of SS, ES and SA**.

```{r domain_on_overall_LR, fig.asp=0.618, fig.width=16}
data_net_tot_score <- data_net_score %>%
  add_column(TOT = data_tot_score$Score)

lin_mod_cats_on_tot <- Qsn_Name_Cont %>%
  map(~str_c("TOT~",.)) %>%
  map(~lm(as.formula(.), data = data_net_tot_score[,3:ncol(data_net_tot_score)]))

sig_lin_mod_cats_on_tot <- lin_mod_cats_on_tot %>%
  map(~step(., direction = "both", trace = 0))

sig_lin_mod_cats_on_tot_summ <- sig_lin_mod_cats_on_tot %>%
  map(~summary(.))

sig_lin_mod_cats_on_tot_plot <- data_net_tot_score %>%
  gather(REC, SA, PC, SS, ER, ES, RES, CON, key = "Domains", value = "Score") %>%
  ggplot(aes(TOT, Score, color = Domains)) +
  geom_point() +
  geom_smooth(method = "lm", formula = "y~x", se = FALSE, size = 2) +
  labs(
    x = "Total Score(In %)",
    y = "Domain Score(In %)"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  ggtitle("Regression Fit of Domain Scores on Total Score") +
  theme(
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "black"),
    strip.background = element_blank()
  ) +
  scale_color_viridis(discrete = TRUE)

R.2.table <- present_R.2(sig_lin_mod_cats_on_tot)
Resid.table <- present_ssr(sig_lin_mod_cats_on_tot)

Models <- ggarrange(R.2.table, Resid.table, nrow = 2, ncol = 1)

p <- ggarrange(sig_lin_mod_cats_on_tot_plot, Models, ncol = 2, nrow = 1, widths = c(8, 4))

annotate_figure(
  p,
  top = text_grob("Linear Model for Dependence of Each Domain Scores on Total Score", face = "bold", size = 16)
)
```

-   So, as a result to see how the dependence of total scores are on the domain scores, mainly the slope will be important for us to analyse and increasing the slope would be a goal though our environmental education. It is again focused that the total score maxes out at about 90% even when all domain scores are 100%, which implies further **awareness in all the domains is required**. The slopes of SS and ES are low in among students so education is very important so as to increase the slope for these domains on total score.

```{r overall_on_domain_LR, fig.asp=0.618, fig.width=16}
# Linear Model Dependence of the Catgories with Total Score
data_net_tot_score <- data_net_score %>%
  add_column(TOT = data_tot_score$Score)

lin_mod_tot_on_cats <- Qsn_Name_Cont %>%
  map(~str_c(.,"~TOT")) %>%
  map(~lm(as.formula(.), data = data_net_tot_score[,3:ncol(data_net_tot_score)]))

sig_lin_mod_tot_on_cats <- lin_mod_tot_on_cats %>%
  map(~step(., direction = "both", trace = 0))

sig_lin_mod_tot_on_cats_summ <- sig_lin_mod_tot_on_cats %>%
  map(~summary(.))

sig_lin_mod_tot_on_cats_plot <- data_net_tot_score %>%
  gather(REC, SA, PC, SS, ER, ES, RES, CON, key = "Domains", value = "Score") %>%
  ggplot(aes(Score, TOT, color = Domains)) +
  geom_point() +
  geom_smooth(method = "lm", formula = "y~x", se = FALSE, size = 2) +
  labs(
    x = "Domain Score(In %)",
    y = "Total Score(In %)"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  ggtitle("Regression Fit of Total Score on Domain Scores") +
  theme(
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "black"),
    strip.background = element_blank()
  ) +
  scale_color_viridis(discrete = TRUE)

R.2.table <- present_R.2(sig_lin_mod_tot_on_cats)
Resid.table <- present_ssr(sig_lin_mod_tot_on_cats)

Models <- ggarrange(R.2.table, Resid.table, nrow = 2, ncol = 1)

p <- ggarrange(sig_lin_mod_tot_on_cats_plot, Models, ncol = 2, nrow = 1, widths = c(8, 4))

annotate_figure(
  p,
  top = text_grob("Linear Model for Dependence of Total Score on Each Domain Scores", face = "bold", size = 16)
)
```

This section provided lots of insight on the areas we need more stress in the environmental education and we also identified some problems or lacking in the students. Now, we move on to testing the reliability of the response.

## Clustering

Pro-Environmental Attitude Score consists of 8 domain scores as per our Questionnaire Survey. So, we are interested in taking a look at the clusters of similar items from all the domains as obtained from the observations and we are also interested in what composes the high-scorers(higher inclination towards pro-environmental ideas) overall pro-environmental attitude. What are the domains students lack an idea about and how the items group together to convey similar ideas are some of the areas we will focus on in this section of the study.

## Reliability

In this section, we will conduct reliability analysis of the survey response data.Reliability analysis allows you to study the properties of measurement scales and the items that compose the scales. The Reliability Analysis procedure calculates a number of commonly used measures of scale reliability and also provides information about the relationships between individual items in the scale.

Hence, we will here get an overall index of the repeatability or internal consistency of the scale as a whole, and you can identify problem items that should be excluded from the scale

-   We will start from SA Domain and then will move on sequentially as the structure of Questionnaire and will obtain the reliability indices using the Cronbach's . We detect that there is a problem with the SA1 item with the rest of the item in this domain. The r.drop value for SA1 is very low which implies this item doesn't correlate well with the other items in this domain. Even the raw_alpha increases substantially if SA1 is dropped. **SA1 doesn't fit reliably in the SA domain and it might be a reason we saw it score low among the students in the previous section**.

```{r rel_SA, fig.asp=0.8, fig.width=14, warning=FALSE}
# Split Data into the respective categories
data_cat_wise <- Qsn_Name %>%
  map(~select(data_enc, matches(.)))

# Reliability Testing
rel_tests <- data_cat_wise %>%
  map(~alpha(., check.keys = TRUE))

# Present the Result of Reliability Test
conv_to_tibble <- function(data) {
  data <- as_tibble(data) %>%
    mutate(Qsn = rownames(data)) %>%
    select(Qsn, everything())
  return(data)
}

conv_to_tile <- function(data, omit = NULL, title = NULL, x_lab = NULL, y_lab = NULL) {
  p <- data %>%
    select(-all_of(omit)) %>%
    gather(everything(), key = "key", value = "value", -one_of("Qsn")) %>%
    ggplot(aes(Qsn, key, fill = value, color = value)) +
    geom_tile() +
    geom_text(aes(label = round(value, digits = 2)), color = "pink", size = 5) +
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
    ggtitle(title) +
    theme(
      panel.border = element_blank(),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.line = element_line(colour = "black"),
      strip.background = element_blank(),
      legend.position = "none"
    ) + 
    labs(
      x = y_lab,
      y = x_lab
    ) + 
    coord_flip()
  return(p)
}

conv_to_line <- function(data, omit = NULL, title = NULL, x_lab = NULL, y_lab = NULL) {
  p <- data %>%
    select(-all_of(omit)) %>%
    gather(everything(), key = "key", value = "value", -one_of("Qsn")) %>%
    ggplot(aes(Qsn, value, color = key, group = key)) +
    geom_line(size = 2) +
    geom_point(size = 2.5) +
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
    ggtitle(title) +
    theme(
      panel.border = element_blank(),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.line = element_line(colour = "black"),
      strip.background = element_blank()
    ) + 
    labs(
      x = x_lab,
      y = y_lab,
      fill = "Metric"
    )
  return(p)
}

present_alpha <- function(alpha_mod, heading = NULL, visual = TRUE) {
  t1 <- as_tibble(alpha_mod$total) %>% 
    mutate(across(where(is.numeric), ~ round(., digits = 2)))
  t2 <- conv_to_tibble(alpha_mod$alpha.drop)
  t3 <- conv_to_tibble(alpha_mod$item.stats)
  t4 <- conv_to_tibble(alpha_mod$response.freq)
  
  p1 <- ggtexttable(t1, theme = ttheme("mBlue"), rows = NULL) %>%
    tab_add_footnote(text = "Current Reliability Test Scores", size = 10, face = "italic")
  
  if (!visual) {
    p2 <- conv_to_tile(t2, title =  "Alpha after Question Drop", y_lab = "Question Dropped", x_lab = "Reliability Measures")
    p3 <- conv_to_tile(t3, "n", title = "Item Statistics", y_lab = "Question Codes", x_lab = "Item-Correlation Measures, Mean(If Dropped) & SD(If Dropped)")
    p4 <- conv_to_tile(t4, "miss", "Response Frequency", "Options", "Question Code")
  } else {
    p2 <- conv_to_line(t2,"S/N" , title =  "Alpha after Question Drop", x_lab = "Question Dropped", y_lab = "Reliability Measures")
    p3 <- conv_to_line(t3, c("n", "mean", "sd"), title = "Item Statistics", x_lab = "Question Codes", y_lab = "Item-Correlation Measures")
    p4 <- conv_to_tile(t4, "miss", "Response Frequency", "Options", "Question Code")
  }
  
  p <- ggarrange(p1, p2, p3, p4, ncol = 2, nrow = 2)
  
  p <- annotate_figure(
    p,
    top = text_grob(heading, face = "bold", size = 16)
  )
  
  return(p)
}

reliability_plot_names <- str_c("Reliability Analysis of ", Plot_Nmaes1)

present_all_cat_alpha <- pmap(list(heading = reliability_plot_names, alpha_mod = rel_tests), present_alpha)

present_all_cat_alpha[[1]]
```

-   Let's look at the REC domain. The reliability score is very good(i.e. raw_alpha above 0.7). **REC2 seems to be not correlating good with the other items in this domain. It might be because of the students are not much aware about upcycling or don't do it. Hence, education and awareness regarding this need to be imparted.**

```{r rel_REC, fig.asp=0.8, fig.width=14, warning=FALSE}
present_all_cat_alpha[[2]]
```

-   The reliability of PC domain's response is very bad. All the items except PC4 and PC5 also doesn't correlate very well with the scale overall.

```{r rel_PC, fig.asp=0.8, fig.width=14, warning=FALSE}
present_all_cat_alpha[[3]]
```

-   The reliability of the SS Domain's response is good. The first item SS1 doesn't seem to correlate very well with the overall scale.

```{r rel_SS, fig.asp=0.8, fig.width=14, warning=FALSE}
present_all_cat_alpha[[4]]
```

-   The reliability of the ER Domain's response is very good. All the items correlate with the overall score very well.

```{r rel_ER, fig.asp=0.8, fig.width=14, warning=FALSE}
present_all_cat_alpha[[5]]
```

-   The ES Domain's repsonse reliability is good. Though we can achieve better r.drop scores by maybe re-framing the items. The items fit the overall scale good.

```{r rel_ES, fig.asp=0.8, fig.width=14, warning=FALSE}
present_all_cat_alpha[[6]]
```

-   The RES Domain's response has good reliability. All items fit good to the overall scale.

```{r rel_RES, fig.asp=0.8, fig.width=14, warning=FALSE}
present_all_cat_alpha[[7]]
```

-   The CON Domain's response is reliable. All the items fit well in the overall scale.

```{r rel_CON, fig.asp=0.8, fig.width=14, warning=FALSE}
present_all_cat_alpha[[8]]
```

-   Now, if we look at the **overall reliability of the entire questionnaire for finding the pro-environmental attitude**. It turns out that **it has excellent reliability**. **Most the items fit in the scale very well given the goal is mainstream and we need to decide about the pro-environmental attitude as a whole**. But if each part of the survey on different domains are seen, then it turns out that **few items for few domains don't fit in well in reliably finding the domain-level environmental attitude**. We however see, as the domain's item statistics shows, that some items doesn't fit well with the other items very well which are ES1, ES3, SA1, SS1 which stood for preference of working in well-illuminated, airy areas, crowded places making one feel uneasy, safe disposal of waste is costly and thoughts on one individual can't help in conserving environment without social support.

```{r rel_CON, fig.asp=1.2, fig.width=16, warning=FALSE}
present_alpha <- function(alpha_mod, heading = NULL, visual = TRUE) {
  t1 <- as_tibble(alpha_mod$total) %>% 
    mutate(across(where(is.numeric), ~ round(., digits = 2)))
  t2 <- conv_to_tibble(alpha_mod$alpha.drop)
  t3 <- conv_to_tibble(alpha_mod$item.stats)
  
  p1 <- ggtexttable(t1, theme = ttheme("mBlue"), rows = NULL) %>%
    tab_add_footnote(text = "Current Reliability Test Scores", size = 10, face = "italic")
    p2 <- conv_to_line(t2,"S/N" , title =  "Alpha after Question Drop", x_lab = "Question Dropped", y_lab = "Reliability Measures") + 
      theme(legend.position = "bottom") + 
      guides(color=guide_legend(nrow=1,byrow=TRUE))
    p3 <- conv_to_line(t3, c("n", "mean", "sd"), title = "Item Statistics", x_lab = "Question Codes", y_lab = "Item-Correlation Measures") + 
      theme(legend.position = "bottom") + 
      guides(color=guide_legend(nrow=1,byrow=TRUE))
  
  p <- ggarrange(p2, p3, ncol = 1, nrow = 2)
  p <- ggarrange(p1, p, ncol = 1, nrow = 2, heights = c(1, 11))
  
  annotate_figure(
    p,
    top = text_grob(heading, face = "bold", size = 16)
  )
}
all_item_alpha <- present_alpha(alpha(data_enc[,3:ncol(data_enc)], check.keys = TRUE), "Reliability Analysis of Pro-Environmental Attitude Response Data")
all_item_alpha
```

This ends the reliability analysis of our response data and the reliability of all the domains are good except one i.e. PC. The overall survey for pro-environmental attitude measure is excellent.

Hence, we have covered almost all aspects of the response data and have provi
